---
import MoonStar from './icons/moon-star.astro';
import Sun from './icons/sun.astro';
---

<button
  type="button"
  id="theme-selector"
  class="relative grid size-9 place-items-center"
>
  <Sun class="size-[1.2rem] scale-100 transition-transform dark:scale-0" />
  <MoonStar
    class="absolute size-[1.2rem] scale-0 transition-transform dark:scale-100"
  />
  <span class="sr-only">Toggle theme</span>
</button>

<script is:inline>
  const prefersDarkMode = window.matchMedia(
    '(prefers-color-scheme: dark)'
  ).matches;
  const storedTheme = localStorage.getItem('theme');

  if (storedTheme === 'dark' || (!storedTheme && prefersDarkMode)) {
    document.documentElement.classList.add('dark');
    localStorage.setItem('theme', 'dark');
  } else {
    document.documentElement.classList.remove('dark');
    localStorage.setItem('theme', 'light');
  }

  document.getElementById('theme-selector')?.addEventListener('click', () => {
    const isDark = document.documentElement.classList.contains('dark');
    document.documentElement.classList.toggle('dark', !isDark);
    localStorage.setItem('theme', isDark ? 'light' : 'dark');
  });
</script>
